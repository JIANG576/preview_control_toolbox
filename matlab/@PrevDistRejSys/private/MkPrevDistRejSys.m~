function P=MkPrevSys(psys)
% Private method used to of generate the augmented state space representation 
% of a preview system
[n,p,q,lw,m]=Getsz(psys.G);
lr=psys.lr;
N=psys.N;
l=lw+lr;

% absorb Wz and Ww into G
GW=psys.G

[Ag,B1g,B2g,C1g,C2g,D11g,D12,D21g,D22g,Ts]=GetSS(psys.G);
[B1gr,B1gw,D11gr,D11gw,D21gr,D21gw]=GetSSrw(psys.G)

nps=N*lr;

Ap=[zeros(nps-lr,lr) eye(nps-lr,nps-lr);zeros(lr,nps)];
Bp=[zeros(nps-lr,lr);eye(lr)];

C1=[C1g D11gr*Cp zeros(p,nps-lr)];

C2=[C2g zeros(q,nps);zeros(lr,n+nps)];

D21=[ zeros(q,lr) D21gw;  eye(lr) zeros(lr,lw) ];

D11=[ zeros(p,lr) D11gw];

D22=[D22g; zeros(lr,m)];

B=[B1gr B1gw B2g;zeros(nps,lw) Bp zeros(nps,m)];

A=[Ag B1gr*Cp;zeros(nps,n) Ap];
C=[C1;C2];
D=[D11 D12; D21 D22];



P=GenSys(Wyz*ss(A,B,C,D,psys.G.Ts)*Wwru,q+lr,m);

